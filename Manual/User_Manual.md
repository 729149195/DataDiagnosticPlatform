# EXL-50U诊断数据平台用户手册 (Data Diagnostic Platform User Manual)

## 系统概述

EXL-50U诊断数据平台是一个用于实验数据异常检测与分析的综合性系统，主要用于处理和分析实验设备产生的多通道时间序列数据。系统采用前后端分离架构，提供Web界面进行数据可视化、异常标注和自动化检测。

### 系统架构
- **前端**: Vue3 + Element Plus 构建的Web界面
- **后端**: Django REST API + WebSocket实时通信  
- **数据库**: MongoDB存储检测结果，SQLite存储系统配置
- **算法引擎**: Python实现的多种异常检测算法
- **数据源**: MDSplus数据树系统

### 主要功能模块
1. **实验数据分析模块**: 数据可视化、异常标注、结果展示
2. **通道分析模块**: 通道管理、计算分析、字符串操作
3. **自动监控服务**: 实时监控数据更新、自动异常检测
4. **算法管理**: 内置算法管理、参数配置

---

## 系统安装与配置
****
### 环境要求
- **操作系统**: Linux/Windows
- **Python**: 3.8+
- **Node.js**: 14+
- **MongoDB**: 4.4+
- **MDSplus**: 用于数据读取
****
### 安装步骤

#### 1. 前端环境配置
```bash
cd frontend
npm install
```

#### 2. 后端环境配置
```bash
cd backend
pip install -r requirements.txt
```

#### 3. MongoDB数据库配置
```bash
# 进入MongoDB数据存储目录
cd /mnt/8f7d843a-cfa8-4a68-9fd2-9bf3ac52dee6/
# 启动MongoDB服务
numactl --interleave=all mongod --dbpath mongodb_errors_data --bind_ip 0.0.0.0 --port 27017
```

### 系统启动


**启动前端开发服务器:**
```bash
cd frontend
npm run dev
```

**启动自动炮号异常检测:**
```bash
conda activate mdsplus
python auto_mg_md_sync.py
```

**启动监控服务:**
```bash
nohup python3 backend/monitor_service.py > monitor.log 2>&1 &
```

**启动后端API服务器:**
```bash
cd backend
conda activate mdsplus
python -m gunicorn -w 16 -b 0.0.0.0:5000  config.wsgi:application
# -w 16 -b中的16为默认值，需要更高的并发数可提高该值
```

---

## 功能模块详细说明

### 1. 实验数据分析模块

#### 1.1 数据浏览与筛选
- **炮号范围选择**: 指定要分析的实验炮号范围
- **通道类型筛选**: 支持多种诊断通道类型
- **异常类型选择**: 根据物理现象分类的异常类型

#### 1.2 数据可视化
- **多通道单行显示**: 同时展示多个通道的数据曲线
- **单通道多行显示**: 展示单个通道在不同炮号下的数据
- **交互式缩放**: 支持时间轴和幅值轴的缩放操作
- **数据标注**: 手动标记异常区域，支持多种标注类型

#### 1.3 异常检测结果
- **热力图显示**: 展示异常检测结果的统计分析
- **详细列表**: 列出所有检测到的异常及其详细信息
- **结果导出**: 支持将检测结果导出为各种格式

#### 1.4 手绘模式
- **手动标注**: 使用鼠标直接在波形上标记异常区域
- **标注编辑**: 修改、删除已有标注
- **标注保存**: 将手动标注结果保存到数据库

### 2. 通道分析模块

#### 2.1 通道列表管理
- **通道搜索**: 按名称、类型等条件搜索通道
- **通道分组**: 按诊断类型对通道进行分组管理
- **通道信息**: 显示通道的详细属性信息

#### 2.2 通道计算功能
- **数学运算**: 支持通道间的加减乘除运算
- **统计分析**: 计算均值、方差、最大值等统计量
- **滤波处理**: 应用各种数字滤波器
- **频谱分析**: 进行傅里叶变换等频域分析

#### 2.3 通道字符串操作
- **名称批处理**: 批量修改通道名称
- **正则表达式**: 支持正则表达式进行复杂的字符串操作
- **模式匹配**: 按模式匹配通道名称

### 3. 自动监控服务

#### 3.1 监控状态显示
- **MDS+最新炮号**: 显示数据源的最新炮号
- **MongoDB最新炮号**: 显示已处理的最新炮号
- **处理进度**: 实时显示当前处理进度
- **运行状态**: 显示监控服务的运行状态

#### 3.2 自动检测配置
- **算法选择**: 选择要应用的检测算法
- **参数设置**: 配置算法的运行参数
- **调度设置**: 设置自动检测的时间间隔

---


### 算法使用

#### 批量检测运行
```bash
# 处理指定炮号范围，使用并发处理, 并发数不推荐超过5，超过交容易断连
python run_batch_processing.py --start 11001 --end 11100 --batch-size 100 --concurrent 1
```

#### 单一算法运行
```bash
# 对指定通道类型和算法进行检测
python RunDetectAlgorithm/Single_algorithm_to_channel.py --channel-type MP --algorithm error_magnetics_drift
```

---

## 操作指南

### 1. 基本数据分析流程

#### 步骤1: 登录系统
1. 打开浏览器访问: `http://192.168.20.49:5173`
2. 输入用户凭据进行登录

#### 步骤2: 选择数据范围
1. 在实验数据分析模块中选择炮号范围
2. 选择感兴趣的通道类型
3. 设置时间窗口参数

#### 步骤3: 数据可视化
1. 选择可视化模式（多通道单行/单通道多行）
2. 使用工具栏进行缩放、平移等操作
3. 查看数据质量和明显的异常特征

#### 步骤4: 异常检测
1. 选择适当的检测算法
2. 配置算法参数
3. 运行检测并查看结果

#### 步骤5: 结果分析
1. 查看热力图统计结果
2. 分析异常分布规律


## 故障排除

### 常见问题

#### 1. 系统无法启动
**症状**: 访问Web页面显示连接错误

**解决方案**:
1. 检查MongoDB服务是否正常运行
2. 确认SSL证书文件是否存在且有效（虽然禁用但是需要存在）
3. 检查端口5000和5173是否被占用
4. 查看后端日志确认错误信息

#### 2. 数据加载失败
**症状**: 页面显示"数据加载失败"

**解决方案**:
1. 检查MDSplus数据树连接
2. 确认炮号范围是否有效
3. 检查网络连接到数据服务器
4. 验证通道名称是否正确

#### 3. 算法运行错误
**症状**: 检测算法执行失败

**解决方案**:
1. 检查算法文件是否存在
2. 确认数据格式是否符合算法要求
3. 查看算法日志获取详细错误信息
4. 验证算法参数设置

#### 4. 监控服务停止
**症状**: 监控状态显示服务未运行

**解决方案**:
1. 重启监控服务
2. 检查系统资源使用情况
3. 查看监控服务日志文件
4. 确认数据库连接正常

### 日志文件位置
- **监控服务日志**: `monitor.log`
- **算法检测日志**: `RunDetectAlgorithm/logs/`
- **Web服务日志**: 控制台输出

### 性能优化建议
1. **内存管理**: 大批量处理时适当调整并发数
2. **数据库优化**: 定期清理过期的检测结果
3. **网络优化**: 确保到数据服务器的网络稳定
4. **缓存策略**: 启用浏览器缓存以提高加载速度

---

## 系统配置参数

### 后端配置 (backend/config/settings.py)
- **DEBUG**: 调试模式开关
- **ALLOWED_HOSTS**: 允许访问的主机列表
- **CORS_ALLOWED_ORIGINS**: 跨域请求白名单
- **DATABASE**: 数据库连接配置

### 前端配置 (frontend/package.json)
- **dependencies**: 前端依赖包版本
- **scripts**: 构建和开发脚本

### 算法配置
- **并发限制**: MAX_CONCURRENT_CHANNELS = 50
- **重试机制**: max_retries = 5 
- **数据库映射**: DBS 字典配置各数据源

---

## API接口文档

### 主要API端点

#### 数据查询接口
- `GET /api/system-monitor-status`: 获取系统监控状态
- `POST /api/channel-data`: 获取通道数据
- `GET /api/anomaly-results`: 获取异常检测结果

#### 算法管理接口  
- `GET /api/algorithms`: 获取可用算法列表
- `POST /api/run-detection`: 运行异常检测
- `PUT /api/algorithm-config`: 更新算法配置

#### 用户管理接口
- `POST /api/login`: 用户登录
- `GET /api/user-info`: 获取用户信息
- `POST /api/logout`: 用户登出

### WebSocket接口
- `/ws/monitor/`: 实时监控状态推送
- `/ws/progress/`: 处理进度实时更新

---

## 版本信息与更新日志

### 当前版本: v1.0.0

#### 主要特性
- 多通道时间序列数据可视化
- 10种诊断通道的异常检测算法
- 实时监控和自动检测
- Web界面交互式数据分析
- 批量处理和并发检测

#### 已知限制
- 部分算法仍在开发中（导入算法、手绘模式）
- 大数据量处理时可能出现内存压力
- 网络中断可能影响实时监控

---

## 技术支持

### 联系方式
- **技术支持**: 请联系系统管理员
- **问题反馈**: 通过系统内置反馈功能
- **文档更新**: 本手册会随系统版本更新

### 开发团队
- **后端开发**: Django + Python
- **前端开发**: Vue3 + TypeScript  
- **算法开发**: Python科学计算栈
- **系统运维**: Linux服务器管理

### 相关文档
- **维护手册**: 参见 `Maintenance_Manual.md`
- **开发文档**: 参见代码注释和README文件
- **算法文档**: 参见 `RunDetectAlgorithm/` 目录下的各算法说明

